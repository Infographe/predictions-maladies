<div class="container mt-4">
  <h2 class="text-center fade-in">🔮 Prédictions</h2>

  <div class="card shadow p-4 fade show">
    <form (ngSubmit)="envoyerDonnees()" class="row g-3">
      <div class="col-md-4" *ngFor="let feature of displayedColumns.slice(0,5); let i = index">
        <label class="form-label">{{ feature | titlecase }}</label>
        <input type="number" class="form-control" [(ngModel)]="formData[feature]" name="{{ feature }}" required>
      </div>

      <div class="col-12 text-center mt-3">
        <button type="submit" class="btn btn-primary" [disabled]="isLoading">
          <fa-icon *ngIf="!isLoading" [icon]="faSearch"></fa-icon> Prédire
          <fa-icon *ngIf="isLoading" [icon]="faSpinner" spin></fa-icon> 
        </button>

        <button class="btn btn-danger mt-3" (click)="effacerHistorique()">
          <fa-icon [icon]="faTrash"></fa-icon> Effacer l'historique
        </button>
      </div>
    </form>
  </div>
  <div class="col-md-4">
    <label class="form-label">📌 Sélection du modèle</label>
    <select class="form-control" [(ngModel)]="selectedModel">
      <option *ngFor="let model of models" [value]="model">{{ model }}</option>
    </select>
  </div>
  

  <!-- 🔍 Filtres dynamiques -->
  <div class="row mt-3">
    <div class="col-md-2" *ngFor="let feature of displayedColumns; let i = index">
      <input type="text" class="form-control" [(ngModel)]="filterFeatures[i]" (input)="applyFilter()" placeholder="Filtrer {{ feature | titlecase }}">
    </div>
  </div>

  <!-- 📜 Historique des Prédictions -->
  <div class="mt-4">
    <h4>📜 Historique des Prédictions</h4>
    <table mat-table [dataSource]="dataSource" class="mat-elevation-z8 table table-striped">
      <ng-container *ngFor="let col of displayedColumns" [matColumnDef]="col">
        <th mat-header-cell *matHeaderCellDef> {{ col | titlecase }} </th>
        <td mat-cell *matCellDef="let element"> {{ element[col] }} </td>
      </ng-container>

      <thead>
        <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
      </thead>
      <tbody>
        <tr mat-row *matRowDef="let row; columns: displayedColumns;" class="fade-in"></tr>
      </tbody>
    </table>
  </div>

  <!-- Pagination -->
  <mat-paginator [pageSizeOptions]="[5, 10, 20]" showFirstLastButtons></mat-paginator>

  <!-- Boutons d'export -->
  <div class="text-center mt-3">
    <button class="btn btn-success" (click)="exporterCSV()">📥 Exporter en CSV</button>
    <button class="btn btn-info" (click)="exporterExcel()">📊 Exporter en Excel</button>
  </div>
</div>
